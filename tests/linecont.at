# This file is part of Micron testsuite. -*- autotest -*-
# Copyright (C) 2020-2021 Sergey Poznyakoff
#
# This file is distributed under the same license as the testsuite.at
# file in this directory.
AT_SETUP([line continuations])
AT_SKIP_IF([test -z "$FAKELIB_PRELOAD"])
AT_CHECK([mkdir conf])
AT_DATA([conf/crontab],
[MAILTO = ''
@reboot root \
 kill \
   -TERM \
   $MICROND_PID
])
AT_CHECK([
micronh -t 2 \
        -e LD_PRELOAD=$FAKELIB_PRELOAD \
	-- \
	-N \
	-ldebug \
        -gmaster=conf/crontab \
        -gnosystem \
        -gnouser \
        -gnogroup 2>&1 | \
  sed -n -e 's/  */ /g' -e /running/p -e /exit=/p
],
[0],
[micrond: [[INFO]] running reboot jobs
micrond: [[DEBUG]] running "kill -TERM $MICROND_PID" on behalf of 0.0
micrond: [[DEBUG]] exit=0, command="kill -TERM $MICROND_PID"
])
AT_CLEANUP


